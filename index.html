<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Planificator mese săptămânal gratuit – meal-planner.ro</title>
  <meta name="description"
        content="Creează rapid planul tău de mese săptămânal. Generează PDF, listă de cumpărături și folosește aplicația în orice limbă. Gratuit, online, rapid!">
  <link rel="icon" type="image/png" href="/favicon.png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  <!-- Stripe Buy Button embed -->
  <script async src="https://js.stripe.com/v3/buy-button.js"></script>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div class="container py-5" id="pdf-content">
    <!-- Limbi -->
    <div class="text-end mb-3 no-print">
      <select id="lang-switcher" class="form-select w-auto"></select>
    </div>

    <!-- Header -->
    <div class="card mb-4">
      <div class="card-header bg-success text-white text-center">
        <h2 class="mb-0" data-i18n="header"></h2>
      </div>
    </div>

    <!-- Tabel planificator -->
    <div class="card mb-4">
      <div class="card-body">
        <table class="table mb-0">
          <thead>
            <tr>
              <th data-i18n="col.day"></th>
              <th data-i18n="col.lunch"></th>
              <th data-i18n="col.dinner"></th>
            </tr>
          </thead>
          <tbody id="plan-table"></tbody>
        </table>
      </div>
    </div>

    <!-- Lista de cumpărături -->
    <div class="card mb-4">
      <div class="card-body">
        <h5 data-i18n="shoppingList"></h5>
        <ul id="shopping-list" class="list-group list-group-flush"></ul>
      </div>
    </div>

    <!-- Bara butoane -->
    <div class="btn-bar mb-3 no-print">
      <button class="btn btn-success" id="generate-btn">
        <i class="bi bi-file-earmark-pdf"></i>
        <span data-i18n="btn.generate"></span>
      </button>

      <stripe-buy-button
        id="stripe-buy-btn"
        buy-button-id="buy_btn_1RisYyH2AzHMl4LgLfu5ZYSD"
        publishable-key="pk_live_51RgnToH2AzHMl4LgCiF0aRsraaZBoDMJT7Kq6sJHEyk0DDLXACeJAI4SDQyYkzlmzhv5Ej903tKICWZOjO44auoy00xIedUhIr"
        style="display:none"
      ></stripe-buy-button>
    </div>
    <div id="payment-status" class="mt-2 text-end no-print"></div>
  </div>

  <script>
    // Dicționar traduceri (toate limbile)
    const i18n = {
      ro: {
        weekdays:   ['Luni','Marți','Miercuri','Joi','Vineri','Sâmbătă','Duminică'],
        title:      "Planificator Mese Săptămânal",
        header:     "Planificator Mese & Lista de Cumpărături",
        "col.day":  "Ziua",
        "col.lunch":"Prânz (ingrediente)",
        "col.dinner":"Cină (ingrediente)",
        shoppingList:"Lista de cumpărături",
        "btn.generate":"Generează PDF",
        "btn.pay":  "Pay & Download",
        "processing":"Se procesează plata...",
        "maxed":     "Ai atins limita maximă de PDF-uri gratuite.<br>Plătește pentru a debloca descărcarea nelimitată!",
        placeholderL:"ex: cartofi, ceapă",
        placeholderD:"ex: pui, orez"
      },
      en: {
        weekdays:   ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'],
        title:      "Weekly Meal Planner",
        header:     "Weekly Meal Planner & Shopping List",
        "col.day":  "Day",
        "col.lunch":"Lunch (ingredients)",
        "col.dinner":"Dinner (ingredients)",
        shoppingList:"Shopping List",
        "btn.generate":"Generate PDF",
        "btn.pay":  "Pay & Download",
        "processing":"Processing payment...",
        "maxed":     "You have reached the maximum number of free PDFs.<br>Pay to unlock unlimited downloads!",
        placeholderL:"e.g. potatoes, onion",
        placeholderD:"e.g. chicken, rice"
      },
      es: {
        weekdays:   ['Lunes','Martes','Miércoles','Jueves','Viernes','Sábado','Domingo'],
        title:      "Planificador Semanal de Comidas",
        header:     "Planificador de Comidas y Lista de Compras",
        "col.day":  "Día",
        "col.lunch":"Almuerzo (ingredientes)",
        "col.dinner":"Cena (ingredientes)",
        shoppingList:"Lista de Compras",
        "btn.generate":"Generar PDF",
        "btn.pay":  "Pagar y Descargar",
        "processing":"Procesando pago...",
        "maxed":     "Has alcanzado el máximo de PDFs gratis.<br>¡Paga para desbloquear descargas ilimitadas!",
        placeholderL:"ej: papas, cebolla",
        placeholderD:"ej: pollo, arroz"
      },
      fr: {
        weekdays:   ['Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi','Dimanche'],
        title:      "Planificateur de Repas Hebdomadaire",
        header:     "Planificateur de Repas & Liste de Courses",
        "col.day":  "Jour",
        "col.lunch":"Déjeuner (ingrédients)",
        "col.dinner":"Dîner (ingrédients)",
        shoppingList:"Liste de Courses",
        "btn.generate":"Générer PDF",
        "btn.pay":  "Payer & Télécharger",
        "processing":"Traitement du paiement...",
        "maxed":     "Nombre maximum de PDF gratuits atteint.<br>Payer pour débloquer le téléchargement illimité !",
        placeholderL:"ex : pommes de terre, oignon",
        placeholderD:"ex : poulet, riz"
      },
      ru: {
        weekdays:   ['Понедельник','Вторник','Среда','Четверг','Пятница','Суббота','Воскресенье'],
        title:      "Еженедельный планировщик питания",
        header:     "Планировщик питания & Список покупок",
        "col.day":  "День",
        "col.lunch":"Обед (ингредиенты)",
        "col.dinner":"Ужин (ингредиенты)",
        shoppingList:"Список покупок",
        "btn.generate":"Создать PDF",
        "btn.pay":  "Оплатить & Скачать",
        "processing":"Обработка платежа...",
        "maxed":     "Достигнут лимит бесплатных PDF.<br>Оплатите для неограниченных загрузок!",
        placeholderL:"напр.: картофель, лук",
        placeholderD:"напр.: курица, рис"
      },
      zh: {
        weekdays:   ['星期一','星期二','星期三','星期四','星期五','星期六','星期日'],
        title:      "每周用餐计划器",
        header:     "用餐计划器 & 购物清单",
        "col.day":  "日期",
        "col.lunch":"午餐（食材）",
        "col.dinner":"晚餐（食材）",
        shoppingList:"购物清单",
        "btn.generate":"生成 PDF",
        "btn.pay":  "支付并下载",
        "processing":"正在处理付款...",
        "maxed":     "已达到免费PDF最大数量。<br>支付以解锁无限下载！",
        placeholderL:"例如：土豆，洋葱",
        placeholderD:"例如：鸡肉，米饭"
      },
      ja: {
        weekdays:   ['月曜日','火曜日','水曜日','木曜日','金曜日','土曜日','日曜日'],
        title:      "週間ミールプランナー",
        header:     "ミールプランナー＆買い物リスト",
        "col.day":  "日付",
        "col.lunch":"昼食（材料）",
        "col.dinner":"夕食（材料）",
        shoppingList:"買い物リスト",
        "btn.generate":"PDFを作成",
        "btn.pay":  "支払ってダウンロード",
        "processing":"お支払い処理中...",
        "maxed":     "無料PDFの最大数に達しました。<br>無制限ダウンロードのために支払う！",
        placeholderL:"例：ジャガイモ、玉ねぎ",
        placeholderD:"例：鶏肉、ご飯"
      },
      pt: {
        weekdays:   ['Segunda-feira','Terça-feira','Quarta-feira','Quinta-feira','Sexta-feira','Sábado','Domingo'],
        title:      "Planejador Semanal de Refeições",
        header:     "Planejador de Refeições & Lista de Compras",
        "col.day":  "Dia",
        "col.lunch":"Almoço (ingredientes)",
        "col.dinner":"Jantar (ingredientes)",
        shoppingList:"Lista de Compras",
        "btn.generate":"Gerar PDF",
        "btn.pay":  "Pagar & Baixar",
        "processing":"Processando pagamento...",
        "maxed":     "Atingiu o máximo de PDFs gratuitos.<br>Pague para desbloquear downloads ilimitados!",
        placeholderL:"ex: batata, cebola",
        placeholderD:"ex: frango, arroz"
      },
      de: {
        weekdays:   ['Montag','Dienstag','Mittwoch','Donnerstag','Freitag','Samstag','Sonntag'],
        title:      "Wöchentlicher Essensplaner",
        header:     "Essensplaner & Einkaufsliste",
        "col.day":  "Tag",
        "col.lunch":"Mittagessen (Zutaten)",
        "col.dinner":"Abendessen (Zutaten)",
        shoppingList:"Einkaufsliste",
        "btn.generate":"PDF erstellen",
        "btn.pay":  "Bezahlen & Herunterladen",
        "processing":"Zahlung wird verarbeitet...",
        "maxed":     "Maximale Anzahl kostenloser PDFs erreicht.<br>Zahlen Sie, um unbegrenzte Downloads freizuschalten!"
      },
      ar: {
        weekdays:   ['الاثنين','الثلاثاء','الأربعاء','الخميس','الجمعة','السبت','الأحد'],
        title:      "مخطط وجبات أسبوعي",
        header:     "مخطط الوجبات وقائمة التسوق",
        "col.day":  "اليوم",
        "col.lunch":"الغداء (المكونات)",
        "col.dinner":"العشاء (المكونات)",
        shoppingList:"قائمة التسوق",
        "btn.generate":"إنشاء PDF",
        "btn.pay":  "ادفع وحمّل",
        "processing":"يتم معالجة الدفع...",
        "maxed":     "لقد وصلت للحد الأقصى من ملفات PDF المجانية.<br>ادفع لفتح التنزيلات غير المحدودة!",
        placeholderL:"مثال: بطاطس، بصل",
        placeholderD:"مثال: دجاج، أرز"
      },
      hi: {
        weekdays:   ['सोमवार','मंगलुवार','बुधवार','गुरुवार','शुक्रवार','शनिवार','रविवार'],
        title:      "साप्ताहिक भोजन योजना",
        header:     "भोजन योजनाकार और खरीदारी सूची",
        "col.day":  "दिन",
        "col.lunch":"दोपहर का भोजन (सामग्री)",
        "col.dinner":"रात का खाना (सामग्री)",
        shoppingList:"खरीदारी की सूची",
        "btn.generate":"PDF बनाएँ",
        "btn.pay":  "भुगतान और डाउनलोड",
        "processing":"भुगतान प्रोसेस हो रहा है...",
        "maxed":     "आपने मुफ्त PDF की सीमा पूरी कर ली है।<br>अनलिमिटेड डाउनलोड के लिए भुगतान करें!",
        placeholderL:"उदा: आलू, प्याज",
        placeholderD:"उदा: चिकन, चावल"
      }
    };

    // Populate language switcher
    const langNames = {
      ro: "Română", en: "English", es: "Español", fr: "Français",
      ru: "Русский", zh: "中文", ja: "日本語", pt: "Português",
      de: "Deutsch", ar: "العربية", hi: "हिन्दी"
    };
    const langSwitcher = document.getElementById('lang-switcher');
    Object.keys(i18n).forEach(code => {
      const opt = document.createElement('option');
      opt.value = code;
      opt.textContent = langNames[code];
      langSwitcher.append(opt);
    });

    // Initialize language
    let lang = navigator.language.slice(0,2);
    if (!i18n[lang]) lang = 'ro';

    function renderTable() {
      const tbody = document.getElementById('plan-table');
      tbody.innerHTML = '';
      i18n[lang].weekdays.forEach((day, idx) => {
        tbody.insertAdjacentHTML('beforeend', `
          <tr class="planner-row">
            <td><strong>${day}</strong></td>
            <td><input id="d${idx+1}l" class="form-control"
                       placeholder="${i18n[lang].placeholderL}"></td>
            <td><input id="d${idx+1}c" class="form-control"
                       placeholder="${i18n[lang].placeholderD}"></td>
          </tr>
        `);
      });
    }

    function applyTranslations() {
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        el.innerHTML = i18n[lang][key] || el.innerHTML;
      });
      document.title = i18n[lang].title;
      renderTable();
    }

    langSwitcher.value = lang;
    applyTranslations();
    langSwitcher.addEventListener('change', e => {
      lang = e.target.value;
      applyTranslations();
      updateButtonState();
    });

    // Meal collection & shopping list
    function collectMeals() {
      return i18n[lang].weekdays.map((_, i) => ({
        day:    document.querySelector(`#plan-table tr:nth-child(${i+1}) td strong`).textContent,
        lunch:  document.getElementById(`d${i+1}l`).value.trim(),
        dinner: document.getElementById(`d${i+1}c`).value.trim()
      }));
    }
    function renderShoppingList(meals) {
      const ul = document.getElementById('shopping-list');
      ul.innerHTML = '';
      meals.forEach(m => {
        if (m.lunch || m.dinner) {
          ul.insertAdjacentHTML('beforeend', `<li class="list-group-item"><strong>${m.day}</strong></li>`);
          if (m.lunch)  ul.insertAdjacentHTML('beforeend',
            `<li class="list-group-item ps-4">${i18n[lang]["col.lunch"]}: ${m.lunch}</li>`);
          if (m.dinner) ul.insertAdjacentHTML('beforeend',
            `<li class="list-group-item ps-4">${i18n[lang]["col.dinner"]}: ${m.dinner}</li>`);
        }
      });
    }

    // PDF & Stripe Buy Button logic
    let pdfCount = +localStorage.getItem('pdfCount') || 0;
    const btnGen = document.getElementById('generate-btn');
    const btnBuy = document.getElementById('stripe-buy-btn');
    const status = document.getElementById('payment-status');

    function updateButtonState() {
      if (pdfCount < 3) {
        btnGen.style.display = 'inline-block';
        btnBuy.style.display = 'none';
        status.innerHTML = '';
      } else {
        btnGen.style.display = 'none';
        btnBuy.style.display = 'inline-block';
        status.innerHTML = i18n[lang]["maxed"];
      }
    }
    updateButtonState();

    btnGen.addEventListener('click', () => {
      const meals = collectMeals();
      renderShoppingList(meals);

      const clone = document.getElementById('pdf-content').cloneNode(true);
      clone.querySelectorAll('input').forEach(inp => {
        const s = document.createElement('span');
        s.className = 'pdf-span';
        s.textContent = inp.value;
        inp.replaceWith(s);
      });
      clone.querySelectorAll('stripe-buy-button,#generate-btn,#payment-status').forEach(e => e.remove());

      html2pdf().set({
        margin: [10,10,10,10],
        filename: 'meal-planner.pdf',
        jsPDF: { unit:'mm', format:'a4' }
      }).from(clone).save();

      pdfCount++;
      localStorage.setItem('pdfCount', pdfCount);
      updateButtonState();
    });
  </script>
</body>
</html>
